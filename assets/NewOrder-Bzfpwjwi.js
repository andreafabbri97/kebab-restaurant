import{d as f,j as e,U as ie,S as E,e as de,f as ce,h as W,u as oe,r as n,i as xe,k as me,l as he,m as ue,s as b,X as pe,n as be}from"./index-CbNLJmPw.js";import{C as fe}from"./clock-o9dxam7G.js";import{P as je}from"./plus-CE26oQNN.js";const ge=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],Ne=f("banknote",ge);const ke=[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]],ye=f("bike",ke);const ve=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],we=f("chevron-up",ve);const Ce=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Z=f("message-square",Ce);const Se=[["path",{d:"M5 12h14",key:"1ays0h"}]],_e=f("minus",Se);const $e=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],qe=f("smartphone",$e);function ee({isMobile:I=!1,orderType:i,setOrderType:j,selectedTable:w,setSelectedTable:O,tables:T,customerName:A,setCustomerName:P,customerPhone:V,setCustomerPhone:B,cart:c,cartItemsCount:h,cartTotal:g,ivaRate:d,ivaAmount:x,grandTotal:m,expandedItemId:u,setExpandedItemId:N,notes:D,setNotes:C,paymentMethod:k,setPaymentMethod:p,smacPassed:y,setSmacPassed:S,isSubmitting:_,clearCart:$,updateQuantity:q,removeFromCart:z,updateItemNotes:F,submitOrder:U}){return e.jsxs("div",{className:`flex flex-col ${I?"h-full":""}`,children:[e.jsxs("div",{className:"p-3 border-b border-dark-700",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>j("dine_in"),className:`flex items-center justify-center gap-2 px-3 py-2.5 rounded-xl transition-all flex-1 ${i==="dine_in"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Tavolo"})]}),e.jsxs("button",{onClick:()=>j("takeaway"),className:`flex items-center justify-center gap-2 px-3 py-2.5 rounded-xl transition-all flex-1 ${i==="takeaway"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Asporto"})]}),e.jsxs("button",{onClick:()=>j("delivery"),className:`flex items-center justify-center gap-2 px-3 py-2.5 rounded-xl transition-all flex-1 ${i==="delivery"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Domicilio"})]})]}),i==="dine_in"&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs text-dark-400 mb-2",children:"Seleziona tavolo:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:T.map(t=>e.jsx("button",{onClick:()=>O(t.id),className:`px-4 py-2 rounded-xl text-sm font-medium transition-all ${w===t.id?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:t.name},t.id))})]}),(i==="takeaway"||i==="delivery")&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Nome cliente",value:A,onChange:t=>P(t.target.value),className:"input py-2.5 text-base"}),e.jsx("input",{type:"tel",placeholder:"Telefono",value:V,onChange:t=>B(t.target.value),className:"input py-2.5 text-base"})]})]}),e.jsxs("div",{className:"px-3 py-2 bg-dark-900/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-primary-400"}),e.jsxs("span",{className:"text-sm font-medium text-white",children:[h," articoli"]})]}),c.length>0&&e.jsx("button",{onClick:$,className:"text-xs text-red-400 hover:text-red-300 transition-colors px-2 py-1",children:"Svuota"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 min-h-[150px]",children:c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-dark-400 py-8",children:[e.jsx(E,{className:"w-12 h-12 mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Carrello vuoto"}),e.jsx("p",{className:"text-xs mt-1",children:"Tocca un prodotto per aggiungerlo"})]}):e.jsx("div",{className:"space-y-2",children:c.map(t=>e.jsxs("div",{className:"bg-dark-900 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-white text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-primary-400 mt-0.5",children:["â‚¬",t.price.toFixed(2)," Ã— ",t.quantity," = â‚¬",(t.price*t.quantity).toFixed(2)]}),t.notes&&u!==t.id&&e.jsxs("p",{className:"text-xs text-amber-400 mt-1 truncate",children:["ðŸ“ ",t.notes]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>N(u===t.id?null:t.id),className:`w-9 h-9 rounded-lg flex items-center justify-center transition-colors ${u===t.id||t.notes?"bg-amber-500/20 text-amber-400":"bg-dark-700 text-dark-400 hover:bg-dark-600"}`,children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>q(t.id,-1),className:"w-9 h-9 rounded-lg bg-dark-700 flex items-center justify-center hover:bg-dark-600 transition-colors",children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-8 text-center text-base font-semibold",children:t.quantity}),e.jsx("button",{onClick:()=>q(t.id,1),className:"w-9 h-9 rounded-lg bg-dark-700 flex items-center justify-center hover:bg-dark-600 transition-colors",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(t.id),className:"w-9 h-9 ml-1 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors flex items-center justify-center",children:e.jsx(de,{className:"w-4 h-4"})})]})]}),u===t.id&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"w-4 h-4 text-amber-400"}),e.jsx("span",{className:"text-xs text-amber-400 font-medium",children:"Note / Variazioni"})]}),e.jsx("input",{type:"text",value:t.notes||"",onChange:o=>F(t.id,o.target.value),placeholder:"Es: senza cipolla, piccante...",className:"w-full bg-dark-800 border border-dark-600 rounded-lg px-3 py-2 text-sm text-white placeholder-dark-500 focus:outline-none focus:border-amber-500"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:["Senza cipolla","Piccante","Extra salsa","Ben cotto"].map(o=>e.jsxs("button",{onClick:()=>{const v=t.notes||"",L=v?`${v}, ${o}`:o;F(t.id,L)},className:"px-2.5 py-1 text-xs bg-dark-700 text-dark-300 rounded-lg hover:bg-dark-600 transition-colors",children:["+ ",o]},o))})]})]},t.id))})}),c.length>0&&e.jsxs("div",{className:"border-t border-dark-700 bg-dark-800",children:[e.jsx("div",{className:"px-3 py-2 border-b border-dark-700",children:e.jsx("input",{type:"text",placeholder:"Note ordine (opzionale)...",value:D,onChange:t=>C(t.target.value),className:"input py-2.5 text-base"})}),e.jsxs("div",{className:"px-3 py-3 flex items-center gap-2 border-b border-dark-700",children:[e.jsxs("div",{className:"flex gap-2 flex-1",children:[e.jsxs("button",{onClick:()=>p("cash"),className:`flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl transition-all flex-1 ${k==="cash"?"bg-emerald-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Contanti"})]}),e.jsxs("button",{onClick:()=>p("card"),className:`flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl transition-all flex-1 ${k==="card"?"bg-blue-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Carta"})]}),e.jsxs("button",{onClick:()=>p("online"),className:`flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl transition-all flex-1 ${k==="online"?"bg-purple-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Online"})]})]}),e.jsxs("button",{onClick:()=>S(!y),className:`flex items-center gap-1.5 px-4 py-2 rounded-xl transition-all ${y?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[y&&e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"SMAC"})]})]}),e.jsxs("div",{className:"px-3 py-3 space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm text-dark-400",children:[e.jsx("span",{children:"Subtotale"}),e.jsxs("span",{children:["â‚¬",g.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-dark-400",children:[e.jsxs("span",{children:["IVA (",d,"%)"]}),e.jsxs("span",{children:["â‚¬",x.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-xl font-bold text-white pt-2",children:[e.jsx("span",{children:"Totale"}),e.jsxs("span",{className:"text-primary-400",children:["â‚¬",m.toFixed(2)]})]})]}),e.jsx("div",{className:"p-3 pt-0 pb-safe",children:e.jsx("button",{onClick:U,disabled:c.length===0||_,className:"btn-primary w-full py-4 text-base font-semibold",children:_?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-dark-900"}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-5 h-5"}),"Conferma Ordine - â‚¬",m.toFixed(2)]})})})]}),c.length===0&&e.jsx("div",{className:"p-3 border-t border-dark-700 pb-safe",children:e.jsxs("button",{disabled:!0,className:"btn-primary w-full py-4 opacity-50 cursor-not-allowed text-base",children:[e.jsx(E,{className:"w-5 h-5"}),"Aggiungi prodotti"]})})]})}function Ee(){const I=oe(),[i,j]=n.useState([]),[w,O]=n.useState([]),[T,A]=n.useState([]),[P,V]=n.useState(null),[B,c]=n.useState(!0),[h,g]=n.useState(null),[d,x]=n.useState([]),[m,u]=n.useState("dine_in"),[N,D]=n.useState(null),[C,k]=n.useState("cash"),[p,y]=n.useState(""),[S,_]=n.useState(""),[$,q]=n.useState(""),[z,F]=n.useState(!1),[U,t]=n.useState(!1),[o,v]=n.useState(null),[L,R]=n.useState(!1);n.useEffect(()=>{se()},[]);async function se(){try{const[s,a,l,r]=await Promise.all([xe(),me(),he(),ue()]);j(s),O(a),A(l),V(r),s.length>0&&g(s[0].id)}catch(s){console.error("Error loading data:",s),b("Errore nel caricamento dati","error")}finally{c(!1)}}const X=h?w.filter(s=>s.category_id===h&&s.available):w.filter(s=>s.available),Y=d.reduce((s,a)=>s+a.price*a.quantity,0),M=d.reduce((s,a)=>s+a.quantity,0),G=P?.iva_rate||17,J=Y*(G/100),H=Y+J;function K(s){x(a=>a.find(r=>r.id===s.id)?a.map(r=>r.id===s.id?{...r,quantity:r.quantity+1}:r):[...a,{...s,quantity:1}]),b(`${s.name} aggiunto`,"success")}function te(s,a){x(l=>l.map(r=>r.id===s?{...r,quantity:Math.max(0,r.quantity+a)}:r).filter(r=>r.quantity>0))}function ae(s){x(a=>a.filter(l=>l.id!==s))}function re(s,a){x(l=>l.map(r=>r.id===s?{...r,notes:a}:r))}function ne(){x([]),v(null)}async function le(){if(d.length===0){b("Aggiungi almeno un prodotto","warning");return}if(m==="dine_in"&&!N){b("Seleziona un tavolo","warning");return}t(!0);try{const s={date:new Date().toISOString().split("T")[0],total:H,payment_method:C,order_type:m,table_id:m==="dine_in"?N??void 0:void 0,notes:$||void 0,status:"pending",smac_passed:z,customer_name:p||void 0,customer_phone:S||void 0},a=d.map(l=>({menu_item_id:l.id,quantity:l.quantity,price:l.price,notes:l.notes}));await be(s,a),b("Ordine creato con successo!","success"),I("/orders")}catch(s){console.error("Error creating order:",s),b("Errore nella creazione dell'ordine","error")}finally{t(!1)}}if(B)return e.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})});const Q={orderType:m,setOrderType:u,selectedTable:N,setSelectedTable:D,tables:T,customerName:p,setCustomerName:y,customerPhone:S,setCustomerPhone:_,cart:d,cartItemsCount:M,cartTotal:Y,ivaRate:G,ivaAmount:J,grandTotal:H,expandedItemId:o,setExpandedItemId:v,notes:$,setNotes:q,paymentMethod:C,setPaymentMethod:k,smacPassed:z,setSmacPassed:F,isSubmitting:U,clearCart:ne,updateQuantity:te,removeFromCart:ae,updateItemNotes:re,submitOrder:le};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden lg:flex gap-4 h-[calc(100vh-100px)]",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2",children:i.map(s=>e.jsx("button",{onClick:()=>g(s.id),className:`px-6 py-3 rounded-xl font-medium whitespace-nowrap transition-all ${h===s.id?"bg-primary-500 text-dark-900":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:s.name},s.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4",children:X.map(s=>e.jsxs("button",{onClick:()=>K(s),className:"menu-item-card text-left",children:[e.jsx("h3",{className:"font-semibold text-white mb-1 line-clamp-2",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-dark-400 mb-2 line-clamp-2",children:s.description}),e.jsxs("p",{className:"text-xl font-bold text-primary-400",children:["â‚¬",s.price.toFixed(2)]})]},s.id))})})]}),e.jsx("div",{className:"w-[420px] flex flex-col bg-dark-800 rounded-2xl border border-dark-700",children:e.jsx(ee,{...Q})})]}),e.jsxs("div",{className:"lg:hidden flex flex-col h-[calc(100vh-120px)]",children:[e.jsx("div",{className:"flex gap-2 mb-3 overflow-x-auto pb-2 -mx-3 px-3",children:i.map(s=>e.jsx("button",{onClick:()=>g(s.id),className:`px-4 py-2.5 rounded-xl font-medium whitespace-nowrap transition-all text-sm ${h===s.id?"bg-primary-500 text-dark-900":"bg-dark-800 text-dark-300"}`,children:s.name},s.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto -mx-3 px-3 pb-24",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:X.map(s=>{const a=d.find(l=>l.id===s.id);return e.jsxs("button",{onClick:()=>K(s),className:"relative bg-dark-800 rounded-xl p-3 text-left active:scale-[0.98] transition-transform border border-dark-700",children:[a&&e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-primary-500 rounded-full flex items-center justify-center text-xs font-bold text-dark-900",children:a.quantity}),e.jsx("h3",{className:"font-semibold text-white text-sm line-clamp-2 mb-1",children:s.name}),e.jsxs("p",{className:"text-lg font-bold text-primary-400",children:["â‚¬",s.price.toFixed(2)]})]},s.id)})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-dark-900 border-t border-dark-700 lg:hidden z-30 safe-bottom",children:e.jsxs("button",{onClick:()=>R(!0),className:"w-full flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"w-6 h-6 text-primary-400"}),M>0&&e.jsx("span",{className:"absolute -top-2 -right-2 w-5 h-5 bg-primary-500 rounded-full flex items-center justify-center text-xs font-bold text-dark-900",children:M})]}),e.jsx("span",{className:"text-white font-medium",children:d.length===0?"Carrello vuoto":`${M} articoli`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xl font-bold text-primary-400",children:["â‚¬",H.toFixed(2)]}),e.jsx(we,{className:"w-5 h-5 text-dark-400"})]})]})}),L&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>R(!1)}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-dark-800 rounded-t-3xl max-h-[90vh] flex flex-col animate-slide-up",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-1",children:e.jsx("div",{className:"w-12 h-1.5 bg-dark-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-dark-700",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Il tuo ordine"}),e.jsx("button",{onClick:()=>R(!1),className:"p-2 hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(pe,{className:"w-6 h-6 text-dark-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(ee,{...Q,isMobile:!0})})]})]})]}),e.jsx("style",{children:`
        @keyframes slide-up {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }
        .animate-slide-up {
          animation: slide-up 0.3s ease-out;
        }
        .safe-bottom {
          padding-bottom: env(safe-area-inset-bottom, 0);
        }
        .pb-safe {
          padding-bottom: env(safe-area-inset-bottom, 12px);
        }
      `})]})}export{Ee as NewOrder};
